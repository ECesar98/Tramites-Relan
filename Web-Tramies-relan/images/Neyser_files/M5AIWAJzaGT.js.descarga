if (self.CavalryLogger) { CavalryLogger.start_js(["sJPce"]); }

__d('canUseReactEditor',['UserAgent'],(function a(b,c,d,e,f,g){'use strict';var h=typeof b.getSelection==='function',i=h&&(c('UserAgent').isPlatform('iOS')||c('UserAgent').isPlatform('Linux')||c('UserAgent').isPlatform('Mac OS X')||c('UserAgent').isPlatform('Windows')||c('UserAgent').isPlatform('Chrome OS'))&&(c('UserAgent').isEngine('EdgeHTML >= 12')||c('UserAgent').isEngine('Gecko >= 16')||c('UserAgent').isEngine('Trident >= 5')||c('UserAgent').isEngine('WebKit >= 533.16')&&!c('UserAgent').isBrowser('Mobile Safari < 6'));function j(){return i;}f.exports=j;}),null);
__d('applyEmoticonToContentState',['EmoticonsList','applyEmoticonToContentBlock','getTextAfterNearestEntity'],(function a(b,c,d,e,f,g){'use strict';var h=new RegExp(c('EmoticonsList').regexp.source,'g');function i(j,k){var l=k.getAnchorKey(),m=k.getAnchorOffset(),n=j.getBlockForKey(l),o=c('getTextAfterNearestEntity')(n,m),p,q;while(q!==null){q=h.exec(o);if(q!==null)p=q;}if(!p)return j;var r=p[1];if(!r&&m!==o.length)return j;var s=p[2],t=m-o.length,u=t+p.index+p[1].length,v=j.getBlockMap().set(l,c('applyEmoticonToContentBlock')(n,s,u));m-=s.length-1;return j.merge({blockMap:v,selectionBefore:k,selectionAfter:k.merge({anchorOffset:m,focusOffset:m})});}f.exports=i;}),null);
__d('handleBeforeInputForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],(function a(b,c,d,e,f,g){var h=new RegExp(/[\s'".,!?]/);function i(j,k){var l=j.getSelection();if(!l.isCollapsed()||!k||!h.test(k))return j;var m=j.getCurrentContent(),n=c('applyEmoticonToContentState')(m,l);if(n===m)return j;var o=c('DraftModifier').insertText(n,n.getSelectionAfter(),k);return c('EditorState').push(j,o,'insert-characters');}f.exports=i;}),null);
__d('handleSoftNewlineForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],(function a(b,c,d,e,f,g){function h(i){var j=i.getCurrentContent(),k=i.getSelection(),l=c('applyEmoticonToContentState')(j,k),m=c('DraftModifier').splitBlock(l,j===l?k:l.getSelectionAfter());return c('EditorState').push(i,m,'split-block');}f.exports=h;}),null);
__d('UFIMentionsInput.react',['cx','Arbiter','BanzaiScuba','Bootloader','DraftEntity','DraftModifier','DOMVector','EditorState','EmojiFormat','Input','Keys','MentionsInput.react','Parent','React','ReactDOM','SubscriptionsHandler','UFIUIEvents','URI','UFIConfig','addEmojiInput','addEmojiToEditorState','canUseReactEditor','clearImmediate','clickRefAction','containsNode','createEditorStateWithEntities','createMentionEntity','emptyFunction','getMentionsInputDecorator','getMentionsTextForContentState','getVisibleValueForContentState','handleBeforeInputForEmoticon','handleSoftNewlineForEmoticon','isSoftNewlineEvent','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('addEmojiInput')(c('MentionsInput.react')),j=new (c('BanzaiScuba'))('ufi_tinder',null,{addBrowserFields:true,addGeoFields:true,addPredictedGeographyFields:true,addMobileDeviceFields:true,addUser:true}),k=200,l='ufi_comment_composer',m='ufi_reply_composer',n=c('canUseReactEditor')(),o=c('React').PropTypes;function p(u){var v=u.map(function(w){return {kind:'file',type:w.type,getAsFile:c('emptyFunction').thatReturns(w)};});return {clipboardData:{items:v}};}function q(){var u=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return c('createEditorStateWithEntities')({text:u.text||'',ranges:u.ranges,decorator:c('getMentionsInputDecorator')(),entityCreationFn:t});}function r(u){var v=/^image\//;return u.filter(function(w){return v.test(w.type);});}var s=c('React').createClass({displayName:'UFIMentionsInput',propTypes:{onContentChange:o.func,isBroadcasterUFI:o.bool},componentWillMount:function u(){this._subscriptionsHandler=new (c('SubscriptionsHandler'))();this._subscriptionsHandler.addSubscriptions(c('Arbiter').subscribe('Story/delete',function(v,w){var x=w.split(':')[2];if(x===this.props.ftEntIdentifier)this._clearDocumentState();}.bind(this)),c('Arbiter').subscribe(c('UFIUIEvents').Comment,function(v,w){var x,y=this,z=w.ft_id,aa=w.target;if(z!==this.props.ftEntIdentifier)return;if(c('containsNode')(c('ReactDOM').findDOMNode(this),aa))(function(){var ba=c('setImmediate')(function(){this._clearDocumentState();}.bind(y));y._subscriptionsHandler.addSubscriptions({remove:function ca(){c('clearImmediate')(ba);}});})();}.bind(this)));},componentWillUnmount:function u(){if(this._subscriptionsHandler)this._subscriptionsHandler.release();delete this._subscriptionsHandler;},getInitialState:function u(){var v='',w=[];if(this.props.initialData){v=this.props.initialData.value||'';w=this.props.initialData.mentions||[];w=w.map(function(y){return babelHelpers['extends']({},y,{entity:{uid:y.uid,weakreference:y.weakreference}});});}var x=c('EditorState').moveSelectionToEnd(q({ranges:w,text:v}));return {bootloaded:false,fullRender:!!(this.props.initialData&&this.props.initialData.value),typeaheadReporter:null,editorState:x,mentionsSource:null,mentionableEntries:null,fallbackText:v};},hasEnteredText:function u(){return !!this.state.editorState.getCurrentContent().getPlainText().trim();},getText:function u(){var v=this.state.editorState.getCurrentContent();return c('getMentionsTextForContentState')(v);},focus:function u(){this._triggerFullRender(function(){if(n){this.refs.mentionsInput.focus();}else c('ReactDOM').findDOMNode(this.refs.textarea).focus();}.bind(this));},insertMention:function u(v){this._triggerFullRender(function(){if(n){var w=this.state.editorState,x=w.getSelection(),y=w.getCurrentContent(),z=x.getStartKey(),aa=x.getStartOffset(),ba=y.getBlockForKey(z),ca;if(ba.getText().substr(aa-1,1).trim().length>0){var da=c('DraftModifier').replaceText(y,x,' ');x=da.getSelectionAfter();ca=c('DraftModifier').insertText(da,x,v.getTitle(),w.getCurrentInlineStyle(),c('createMentionEntity')(v));}else ca=c('DraftModifier').replaceText(y,x,v.getTitle(),w.getCurrentInlineStyle(),c('createMentionEntity')(v));x=ca.getSelectionAfter();ca=c('DraftModifier').insertText(ca,x,' ');w=c('EditorState').push(w,ca,'insert-fragment');w=c('EditorState').forceSelection(w,w.getSelection());this.setState({editorState:w});this.focus();}else{c('ReactDOM').findDOMNode(this.refs.textarea).focus();if(this.state.fallbackText.length){this.setState({fallbackText:this.state.fallbackText+' '+v.title});}else this.setState({fallbackText:v.title});}}.bind(this));},insertEmoticon:function u(v){if(!n){this.setState({fallbackText:this.state.fallbackText+' '+v});return;}var w=this.state.editorState,x=w.getCurrentContent(),y=w.getSelection(),z=x.getBlockForKey(y.getStartKey()).getText()[y.getStartOffset()-1];if(z&&z!==' ')v=' '+v;var aa=x.getBlockForKey(y.getEndKey()).getText()[y.getEndOffset()];if(aa&&aa!==' ')v+=' ';var ba=c('DraftModifier').replaceText(w.getCurrentContent(),w.getSelection(),v);w=c('EditorState').push(w,ba,'insert-characters');w=c('EditorState').forceSelection(w,w.getSelection());this.setState({editorState:w});},insertEmoji:function u(v){var w=c('EmojiFormat').codeArrayToUnicode(v);if(!n){this.setState({fallbackText:this.state.fallbackText+' '+w});return;}c('addEmojiToEditorState')(w,this.state.editorState,this._onChange);},_informHeightChange:function u(){var v,w=this;if(this.props.monitorHeight)(function(){var x=c('setImmediate')(function(){if(!this.isMounted())return;var y=n?c('ReactDOM').findDOMNode(this.refs.mentionsInput):c('ReactDOM').findDOMNode(this.refs.textarea),z=c('DOMVector').getElementDimensions(y).y;if(z!==this._height){this._height=z;c('Arbiter').inform(c('UFIUIEvents').InputHeightChanged,{node:y});}}.bind(w));w._subscriptionsHandler.addSubscriptions({remove:function y(){c('clearImmediate')(x);}});})();},_onChange:function u(v){if(this.props.onContentChange){var w=this.state.editorState.getCurrentContent(),x=v.getCurrentContent();if(w!==x)this.props.onContentChange(c('getMentionsTextForContentState')(x));}this.setState({editorState:v},this._informHeightChange);},_clearDocumentState:function u(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();this.setState({editorState:c('EditorState').moveFocusToEnd(q())});},_handleContentReturn:function u(v,w){if(c('isSoftNewlineEvent')(v)){this.setState({editorState:c('handleSoftNewlineForEmoticon')(w)});return true;}v.persist();this.setState(function(x){this.submitComment(v,x);return x;}.bind(this));return true;},_handleBeforeInput:function u(v,w){var x=c('handleBeforeInputForEmoticon')(w,v);if(x===w){return false;}else{this.setState({editorState:x});return true;}},submitComment:function u(v){var w=arguments.length<=1||arguments[1]===undefined?this.state:arguments[1],x=w.editorState.getCurrentContent(),y=c('getVisibleValueForContentState')(x),z=c('getMentionsTextForContentState')(x),aa={visibleValue:y,encodedValue:z},ba=c('Input').getValue(c('ReactDOM').findDOMNode(this.refs.proxyInput));if(ba){var ca=new (c('URI'))(b.location.href);j.addNormal('path',ca.getPath());j.addNormal('proxy_value',ba.substr(0,k));j.post();}return this.props.onEnterSubmit(aa,v);},_handleFiles:function u(v){var w=r(v);if(w.length){this.props.onPaste(p(w));return true;}return false;},_handleDroppedFiles:function u(v,w){return this._handleFiles(w);},_handlePastedFiles:function u(v){return this._handleFiles(v);},_onMentionsInputBlur:function u(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();this.props.onBlur&&this.props.onBlur();c('Arbiter').inform(c('UFIUIEvents').Blur,{ftEntIdentifier:this.props.ftEntIdentifier,instanceID:this.props.instanceID,hasEnteredText:this.hasEnteredText()});},_onMentionsInputFocus:function u(){if(!this.state.bootloaded&&!this._currentlyBootloading){this._currentlyBootloading=true;c('Bootloader').loadModules(["TypeaheadMetricReporter","getMentionsSearchSource"],function(v,w){if(!this.isMounted())return;var x=new v({event_name:'tinder_mentions'});x.sessionStart();var y=w(this.props.datasource,x,c('UFIConfig').showHashtagTypeahead);y.bootstrap();this.setState({typeaheadReporter:x,bootloaded:true,mentionsSource:y},function(){this._currentlyBootloading=false;}.bind(this));}.bind(this),'UFIMentionsInput.react');}else if(this.state.typeaheadReporter)this.state.typeaheadReporter.sessionStart();this.props.onFocus&&this.props.onFocus();c('Arbiter').inform(c('UFIUIEvents').Focus,{ftEntIdentifier:this.props.ftEntIdentifier,instanceID:this.props.instanceID});},_onShowMentions:function u(v,w){if(this.state.typeaheadReporter)this.state.typeaheadReporter.reportResults(v.map(function(x){return x.getUniqueID();}));},_onAddMention:function u(v,w,x){if(this.state.typeaheadReporter){this.state.typeaheadReporter.reportSelect(v.getUniqueID(),v.getType(),w,x.button>=0);this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}},_onFallbackKeyDown:function u(v){if(v.which!==c('Keys').RETURN)return;if(c('isSoftNewlineEvent')(v)||!this.state.fallbackText.trim())return;v.preventDefault();var w={visibleValue:this.state.fallbackText,encodedValue:this.state.fallbackText};if(this.props.onEnterSubmit(w,v))this.setState({fallbackText:''});},_onFallbackChange:function u(v){this.setState({fallbackText:v.target.value});},_onFallbackBlur:function u(v){this.props.onBlur&&this.props.onBlur();},_onFallbackFocus:function u(v){this.props.onFocus&&this.props.onFocus();},_sortByRenderType:function u(v,w){var x=v.getAuxiliaryData().renderType,y=w.getAuxiliaryData().renderType;if(x===y)return v.getOrder()-w.getOrder();var z=this.props.viewOptionsTypeObjectsOrder;return z.indexOf(x)-z.indexOf(y);},_triggerFullRender:function u(v){this.setState({fullRender:true},v);},_triggerFullRenderWithoutCallback:function u(){this._triggerFullRender();},_renderFallback:function u(){return c('React').createElement('div',{className:"_2xwx _289b"},c('React').createElement('textarea',{ref:'textarea',className:"UFIAddCommentInput _1os9 _2xww",name:'add_comment_text',placeholder:this.props.placeholder,spellCheck:true,onKeyDown:this._onFallbackKeyDown,onChange:this._onFallbackChange,onBlur:this._onFallbackBlur,onFocus:this._onFallbackFocus,value:this.state.fallbackText}));},_renderProxyInput:function u(){if(!this.props.hideProxyInput){var v="_1osa mentionsHidden";return c('React').createElement('input',{className:v,name:'add_comment_text',ref:'proxyInput',onFocus:this.focus,tabIndex:'-1'});}},_renderDummy:function u(){var v="UFIAddCommentInput _1osb _1osc _2xww";return c('React').createElement('div',{onClick:this._triggerFullRenderWithoutCallback,className:"_2xwx",onFocus:this._triggerFullRenderWithoutCallback,onMouseOver:this._triggerFullRenderWithoutCallback,onSelect:c('emptyFunction'),onTouchStart:this._triggerFullRenderWithoutCallback,role:'presentation'},this._renderProxyInput(),c('React').createElement('div',{className:v},this.props.placeholder));},_onClickEditorContainer:function u(v){c('clickRefAction')('ufi',v.target,null,'FORCE');},_renderMentionsInput:function u(){var v="UFIAddCommentInput _1osb _2xww",w=babelHelpers['extends']({mentionSortFn:this.props.viewOptionsTypeObjectsOrder?this._sortByRenderType:null},this.props.viewProps);return c('React').createElement('div',{className:"_2xwx _289c",onClick:this._onClickEditorContainer,role:'presentation'},this._renderProxyInput(),c('React').createElement(i,{ref:'mentionsInput',className:v,editorState:this.state.editorState,onChange:this._onChange,mentionsSource:this.state.mentionsSource,typeaheadView:this.props.viewComponent,typeaheadViewProps:w,spellCheck:true,placeholder:this.props.placeholder,onAddMention:this._onAddMention,onShowMentions:this._onShowMentions,onFocus:this._onMentionsInputFocus,onBlur:this._onMentionsInputBlur,handleContentReturn:this._handleContentReturn,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,autoflip:this.props.autoflip,position:this.props.isBroadcasterUFI?'above':null,webDriverTestID:this.props.replyCommentID?m:l}));},componentDidMount:function u(){var v,w=this;if(!n){if(this.state.fallbackText)c('ReactDOM').findDOMNode(this.refs.textarea).focus();}else if(this.state.editorState.getCurrentContent().hasText())(function(){var x=c('setImmediate')(function(){this.isMounted()&&this.focus();}.bind(w));w._subscriptionsHandler.addSubscriptions({remove:function y(){c('clearImmediate')(x);}});})();},render:function u(){if(!n)return this._renderFallback();if(!this.state.fullRender)return this._renderDummy();return this._renderMentionsInput();}});function t(u){return c('DraftEntity').create('MENTION','IMMUTABLE',{id:u.uid,isWeak:u.weakreference});}f.exports=s;}),null);
__d('OGHovercardFeedback',['Event','Arbiter','CSS','DOM','ScrollableArea','TextAreaControl','UFIUIEvents','ge'],(function a(b,c,d,e,f,g){Object.assign(h,{init:function i(j,k,l){new h(j,k,l);}});function h(i,j,k){this._hovercard=i;this._focusListener=null;for(var l=0;l<j.length;l++)this.conditionClassOnHovercard(j[l],k);c('Arbiter').subscribe(c('UFIUIEvents').Comment,function(m,n){this._scrollComments(n.isinverted?'toTop':'toBottom');}.bind(this));i.subscribe('show',this._initCommentTextAreaAndFocusListener.bind(this));}Object.assign(h.prototype,{conditionClassOnHovercard:function i(j,k){var l=c('ge')(j);this._hovercard.subscribe('beforeshow',function(){c('CSS').addClass(l,k);});this._hovercard.subscribe('hide',function(){c('CSS').removeClass(l,k);});},_scrollComments:function i(j){var k=this._hovercard.getContent(),l=k&&c('DOM').scry(k,'.uiScrollableAreaWrap')[0],m=l&&c('ScrollableArea').getInstance(l);if(j==='toTop'){m&&m.scrollToTop();}else m&&m.scrollToBottom();},_initCommentTextAreaAndFocusListener:function i(){var j=this._hovercard.getContent(),k=j&&c('DOM').scry(j,'.ogHovercardFooter textarea')[0];if(k){var l=c('TextAreaControl').getInstance(k);if(l&&l.isEmpty())l.clear();if(this._focusListener)return;this._focusListener=c('Event').listen(k,'focus',this._scrollComments.bind(this));}}});f.exports=h;}),null);